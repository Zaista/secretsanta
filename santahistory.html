<html>
	<head>
		<meta charset="UTF-8">
		<meta name="description" content="Secret Santa archive for my friends">
		<meta name="keywords" content="secret,santa,secretsanta,friends,christmas,archive">
		<meta name="author" content="Jovan Ilic">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>Secret Santa Archive</title>
		<link rel="stylesheet" type="text/css" href="secretsanta.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
		<script src="secretsanta.js"></script>
		<link rel="icon" type="img/ico" href="favicon.ico">

		<!-- Bootstrap -->
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

		<!-- For facebook crawler -->
		<meta property="og:url"          content="http://www.secretsanta.jovanilic.com/santahistroy.html" />
		<meta property="og:site_name"    content="secretsanta.jovanilic.com" />
		<meta property="og:title"        content="Secret Santa Archive" />
		<meta property="og:type"         content="website" />
		<meta property="og:description"  content="Secret Santa archive for my friends!" />
		
		<script id="year_template" type="template">
            <div class="panel panel-default">
				<a data-toggle="collapse" data-parent="#accordion" href="#archive{{year}}">
					<div class="panel-heading">
						<h4 class="panel-title">
							<b>{{year}}</b>
						</h4>
					</div>
				</a>
			    <div id="archive{{year}}" class="panel-collapse collapse">
					<div class="panel-body">
                        <table class="table table-striped">
							<thead>
								<tr>
									<th>Santa</th>
									<th>Child</th>
									<th>Gift</th>
									<th>Image</th>
								</tr>
							</thead>
                            <tbody id="table_body">
							</tbody>
						</table>
						<p class="location"><b>Location:</b> <span id="label"></span> <span id="location_image" class="glyphicon glyphicon-picture picture-disabled pull-right" aria-hidden="true" data-toggle="modal" data-target="#present" data-picture=""></span></p>
					</div>
			    </div>
			</div>
        </script>
        
        <script id="row_template" type="template">
			<tr>
				<td>{{santa}}</td>
				<td>{{child}}</td>
				<td>{{gift}}</td>
				<td class="text-right"><span class="glyphicon glyphicon-picture picture-disabled" onclick="return false;" aria-hidden="true" data-toggle="modal" data-target="#present" data-picture="{{Year}}/{{image}}"></span></td>
			</tr>
        </script>
		
		<script type="text/javascript">
    		$.getJSON( "getHistory.php", function( data ) {

				$.each(data, function(archiveYear, archiveData ) {

					addYear(archiveYear);

					$.each(archiveData, function(property, rowData) {

						if(property === "label")
						{
							$("#archive" + archiveYear + " #label").text(rowData);
							return true;
						}

						if(property === "image")
						{
							if(rowData != null) {
								$("#archive" + archiveYear + " #location_image").attr("data-picture", archiveYear + "/" + rowData);
								$("#archive" + archiveYear + " #location_image").removeClass("picture-disabled");
							} else {
								$("#archive" + archiveYear + " #location_image").attr("data-toggle", "");
							}
							return true;
						}
						addRow(rowData);
					});
					
				});
   			});

   			function addYear(archiveYear) {
   	   			
				var year_template = $.trim($('#year_template').html());
				year_template = year_template.replace(/{{year}}/g, archiveYear);
			    $('#accordion').append(year_template);
   			}

   			function addRow(archiveRow) {

			    var row_template;
				row_template = $.trim($('#row_template').html());
			    if (archiveRow.Image != null) {
				    console.log("here1");
					row_template = row_template.replace(/{{year}}/ig, archiveRow.Year);
					row_template = row_template.replace(/{{image}}/ig, archiveRow.Image);
					row_template = row_template.replace("picture-disabled", "");
			    } else {
				    console.log("here2");
				    row_template = row_template.replace("data-toggle=\"modal\"", "");

					console.log(row_template);
			    }
				row_template = row_template.replace(/{{santa}}/ig, archiveRow.Santa);
				row_template = row_template.replace(/{{child}}/ig, archiveRow.Child);
				row_template = row_template.replace(/{{gift}}/ig, archiveRow.Gift);

			    $('div#archive' + archiveRow.Year + ' .table').append(row_template);
   			}
		</script>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-6 col-md-offset-3  col-xs-12">
					<img id="img" src="resources/images/santa.jpg">
				</div>
			</div>
			<div class="row">
				<div class="col-md-6 col-md-offset-3 col-xs-12">
					<div class="panel-group" id="accordion">

					</div>
					<a href="secretsanta.html">
						<button class="btn btn-primary">Back</button>
					</a>
				</div>
			</div>
			<div id="present" class="modal fade" tabindex="-1" role="dialog">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-body">
							<img id="image" class="img-responsive">
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
